<div class="task-form-container">
  <mat-toolbar color="primary">
    <button mat-icon-button (click)="onCancel()">
      <mat-icon>arrow_back</mat-icon>
    </button>
    <span>{{ isEditMode ? 'Editar Tarefa' : 'Nova Tarefa' }}</span>
  </mat-toolbar>
  <div *ngIf="loading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Carregando tarefa...</p>
  </div>
  <div *ngIf="!loading" class="form-container">
    <mat-card>
      <mat-card-header>
        <mat-card-title style="padding-bottom: 5px;">
          <mat-icon>{{ isEditMode ? 'edit' : 'add' }}</mat-icon>
          {{ isEditMode ? 'Editar Tarefa' : 'Criar Nova Tarefa' }}
        </mat-card-title>
        <mat-card-subtitle style="padding: 10px 0;">
          {{ isEditMode ? 'Atualize as informações da tarefa' : 'Preencha os dados da nova tarefa' }}
        </mat-card-subtitle>
      </mat-card-header>
      <mat-card-content>
        <form [formGroup]="taskForm" (ngSubmit)="onSubmit()" class="task-form">
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Título da Tarefa</mat-label>
            <input 
              matInput 
              formControlName="title"
              placeholder="Digite o título da tarefa"
              maxlength="100">
            <mat-icon matSuffix>title</mat-icon>
            <mat-hint>{{ title?.value?.length || 0 }}/100</mat-hint>
            <mat-error *ngIf="title?.invalid && title?.touched">
              {{ getTitleErrorMessage() }}
            </mat-error>
          </mat-form-field>
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descrição</mat-label>
            <textarea 
              matInput 
              formControlName="description"
              placeholder="Descreva os detalhes da tarefa"
              rows="4"
              maxlength="500">
            </textarea>
            <mat-icon matSuffix>description</mat-icon>
            <mat-hint>{{ description?.value?.length || 0 }}/500</mat-hint>
            <mat-error *ngIf="description?.invalid && description?.touched">
              {{ getDescriptionErrorMessage() }}
            </mat-error>
          </mat-form-field>
        </form>
      </mat-card-content>
      <mat-card-actions >
        <button 
          mat-button 
          type="button" 
          (click)="onCancel()"
          [disabled]="submitting">
          <mat-icon>cancel</mat-icon>
          Cancelar
        </button>
        <button 
          mat-raised-button 
          color="primary" 
          type="submit"
          (click)="onSubmit()"
          [disabled]="taskForm.invalid || submitting">
          <mat-spinner *ngIf="submitting" diameter="20"></mat-spinner>
          <mat-icon *ngIf="!submitting">{{ isEditMode ? 'save' : 'add' }}</mat-icon>
          {{ submitting ? 'Salvando...' : (isEditMode ? 'Atualizar' : 'Criar') }}
        </button>
      </mat-card-actions>
    </mat-card>
  </div>
</div>
